
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://brace2.github.io/OpenSeesRT/developer/extending/4000-NewElement/">
      
      <link rel="icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-, mkdocs-material-8.2.13">
    
    
      
        <title>Introducing a New Element into OpenSees - OpenSeesRT</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=serif:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"serif";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../math.css">
    
      <link rel="stylesheet" href="../../../particle.css">
    
      <link rel="stylesheet" href="../../../grid.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OpenSeesRT" class="md-header__button md-logo" aria-label="OpenSeesRT" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenSeesRT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introducing a New Element into OpenSees
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../library/analysis/DirectIntegration/" class="md-tabs__link">
        Library
      </a>
    </li>
  

  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OpenSeesRT" class="md-nav__button md-logo" aria-label="OpenSeesRT" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    OpenSeesRT
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1">
          Library
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Library" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Library
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Analysis" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_1" type="checkbox" id="__nav_1_1_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../library/analysis/DirectIntegration/">DirectIntegrationAnalysis</a>
          
            <label for="__nav_1_1_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="DirectIntegrationAnalysis" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_1">
          <span class="md-nav__icon md-icon"></span>
          DirectIntegrationAnalysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/231-Explicit%20Difference/" class="md-nav__link">
        Explicit Difference

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/277-Generalized%20Alpha%20Method/" class="md-nav__link">
        Generalized Alpha Method

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/326-Hilber-Hughes-Taylor%20Method/" class="md-nav__link">
        Hilber-Hughes-Taylor

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/416-Newmark%20Method/" class="md-nav__link">
        Newmark Method

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/675-TRBDF2/" class="md-nav__link">
        TRBDF2

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/81-Central%20Difference/" class="md-nav__link">
        Central Difference

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/DirectIntegration/_implementation/" class="md-nav__link">
        
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_2" type="checkbox" id="__nav_1_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_1_2">
          EigenAnalysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="EigenAnalysis" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          EigenAnalysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/Eigen_Analysis/ArpackSolver/" class="md-nav__link">
        ArpackSolver

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/Eigen_Analysis/EigenAlgorithm/" class="md-nav__link">
        
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/Eigen_Analysis/FrequencyAlgo/" class="md-nav__link">
        FrequencyAlgo

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/Eigen_Analysis/StandardEigenAlgo/" class="md-nav__link">
        StandardEigenAlgo

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_3" type="checkbox" id="__nav_1_1_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../library/analysis/">StaticAnalysis</a>
          
            <label for="__nav_1_1_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="StaticAnalysis" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_3">
          <span class="md-nav__icon md-icon"></span>
          StaticAnalysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/154-Displacement%20Control/" class="md-nav__link">
        Displacement Control

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/24-Arc-Length%20Control/" class="md-nav__link">
        Arc-Length Control

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/372-Load%20Control/" class="md-nav__link">
        Load Control

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/387-Minimum%20Unbalanced%20Displacement%20Norm/" class="md-nav__link">
        Minimum Unbalanced Displacement Norm

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/EQPath/" class="md-nav__link">
        EQPath

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/HSConstraint/" class="md-nav__link">
        HSConstraint

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/" class="md-nav__link">
        StaticAnalysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/LoadPath/" class="md-nav__link">
        LoadPath

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/ParkLMS3/" class="md-nav__link">
        ParkLMS3

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/analysis/StaticAnalysis/StagedLoadControl/" class="md-nav__link">
        StagedLoadControl

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Modeling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modeling" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Modeling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1" type="checkbox" id="__nav_1_2_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1">
          Uniaxial Material
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Uniaxial Material" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          Uniaxial Material
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_1" type="checkbox" id="__nav_1_2_1_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_1">
          Elastic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Elastic" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          Elastic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/elastic/181-ElasticMultiLinear/" class="md-nav__link">
        ElasticMultiLinear

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/elastic/195-Elastic%20Uniaxial/" class="md-nav__link">
        Elastic

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/elastic/180-ElasticBilin/" class="md-nav__link">
        ElasticBilin

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_2" type="checkbox" id="__nav_1_2_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_2">
          Generic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Generic" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Generic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/bouc/64-BoucWen/" class="md-nav__link">
        BoucWen

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/generic/322-Hardening/" class="md-nav__link">
        Hardening

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/generic/179-Elastic-Perfectly%20Plastic/" class="md-nav__link">
        Elastic-Perfectly Plastic

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/generic/404-MultiLinear/" class="md-nav__link">
        MultiLinear

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_3" type="checkbox" id="__nav_1_2_1_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_3">
          Metallic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metallic" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_3">
          <span class="md-nav__icon md-icon"></span>
          Metallic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/666-Steel02/" class="md-nav__link">
        Steel02

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/668-SteelMPF/" class="md-nav__link">
        SteelMPF

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/587-Reinforcing%20Steel/" class="md-nav__link">
        ReinforcingSteel

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/667-Steel4/" class="md-nav__link">
        Steel4

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/158-DoddRestrepo/" class="md-nav__link">
        DoddRestrepo

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/730-UVCuniaxial/" class="md-nav__link">
        UVCuniaxial

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/metallic/569-RambergOsgoodSteel/" class="md-nav__link">
        RambergOsgoodSteel

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_4" type="checkbox" id="__nav_1_2_1_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_4">
          Concrete
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concrete" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_4">
          <span class="md-nav__icon md-icon"></span>
          Concrete
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/97-ConfinedConcrete01/" class="md-nav__link">
        ConfinedConcrete01

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/94-ConcreteCM/" class="md-nav__link">
        ConcreteCM

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/91-Concrete04/" class="md-nav__link">
        Concrete04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/90-Concrete02/" class="md-nav__link">
        Concrete02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/92-Concrete06/" class="md-nav__link">
        Concrete06

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/concrete/Concrete02IS/" class="md-nav__link">
        Concrete02IS

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_5" type="checkbox" id="__nav_1_2_1_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_5">
          Geotechnical
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Geotechnical" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_5">
          <span class="md-nav__icon md-icon"></span>
          Geotechnical
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/geotechnical/557-PySimple1/" class="md-nav__link">
        PySimple1

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/geotechnical/565-QzSimple1/" class="md-nav__link">
        QzSimple1

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_1_6" type="checkbox" id="__nav_1_2_1_6" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_1_6">
          Wrappers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wrappers" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_1_6">
          <span class="md-nav__icon md-icon"></span>
          Wrappers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/wrapper/489-Parallel/" class="md-nav__link">
        Parallel

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/uniaxial/wrapper/632-Series/" class="md-nav__link">
        Series

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_2" type="checkbox" id="__nav_1_2_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_2">
          Element
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Element" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_2">
          <span class="md-nav__icon md-icon"></span>
          Element
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_2_1" type="checkbox" id="__nav_1_2_2_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_2_1">
          Beam
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Beam" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          Beam
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/element/beam/2057-Force-Based%20Beam-Column%20Element/" class="md-nav__link">
        Force-Based Beam-Column Element

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/element/beam/2184-Elastic%20Beam%20Column%20Element/" class="md-nav__link">
        ElasticBeamColumn

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_3" type="checkbox" id="__nav_1_2_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_3">
          Constraint
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Constraint" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_3">
          <span class="md-nav__icon md-icon"></span>
          Constraint
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/constraints/602-RigidLink/" class="md-nav__link">
        RigidLink

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_4" type="checkbox" id="__nav_1_2_4" >
      
      
      
        
          
        
          
            
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../library/modeling/pattern/plain/">Pattern</a>
          
            <label for="__nav_1_2_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Pattern" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          Pattern
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/pattern/Multisupport_Excitation/" class="md-nav__link">
        Multisupport Excitation

      </a>
    </li>
  

            
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/pattern/740-Uniform%20Excitation%20Pattern/" class="md-nav__link">
        Uniform Excitation Pattern

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modeling/pattern/" class="md-nav__link">
        Load Patterns

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utilities" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/utilities/units/" class="md-nav__link">
        Units
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3_2" type="checkbox" id="__nav_1_3_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_3_2">
          Recorders
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Recorders" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          Recorders
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/utilities/recorders/208-Element%20Recorder/" class="md-nav__link">
        Element

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/utilities/recorders/431-Node%20Recorder/" class="md-nav__link">
        Node

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_4">
          Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4_1" type="checkbox" id="__nav_1_4_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_4_1">
          Algebraic Hysteresis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Algebraic Hysteresis" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_4_1">
          <span class="md-nav__icon md-icon"></span>
          Algebraic Hysteresis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/AlgebraicHysteresis/backbone/RaynorBackbone/" class="md-nav__link">
        Raynor

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/AlgebraicHysteresis/backbone/LinearCappedBackbone/" class="md-nav__link">
        LinearCapped

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/AlgebraicHysteresis/backbone/MultilinearBackbone/" class="md-nav__link">
        Multilinear

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/AlgebraicHysteresis/backbone/ArctangentBackbone/" class="md-nav__link">
        Arctangent

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/AlgebraicHysteresis/backbone/ManderBackbone/" class="md-nav__link">
        Mander

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4_2" type="checkbox" id="__nav_1_4_2" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_4_2">
          Nonlinear Beam-Column
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Nonlinear Beam-Column" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_4_2">
          <span class="md-nav__icon md-icon"></span>
          Nonlinear Beam-Column
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../library/modules/NonlinearBeamColumn/geometry/370-Linear%20Transformation/" class="md-nav__link">
        Linear

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="new-elements">New Elements</h1>
<h2 id="introduction">Introduction</h2>
<p>This document is intended to demonstrate the steps necessary to introduce a new element into the OpenSees interpreter. OpenSees is an object-oriented framework under construction for finite element analysis. A key feature of OpenSees is the interchangeably of components and the ability to integrate existing libraries and new components into the framework (not just new element classes) without the need to change the existing code. Core components, that is the abstract base classes, define the minimal interface (minimal to make adding new component classes easier but large enough to ensure all that is required can be accommodated).</p>
<p>The OpenSees interpreter is an extension of the Tcl scripting language. Tcl is a string based procedural command language which allows substitution, loops, mathematical expressions, and procedures. The OpenSees interpreter adds commands to Tcl to allow users to create objects from the OpenSees framework and invoke methods on those objects once they have been created. Each of these commands is associated (bound) with a C++ procedure that is provided. It is this procedure that is called upon by the interpreter to parse the command.</p>
<p>In this document we provide a simple example of a script that can be used with the OpenSees interpreter to analyze a simple model. We then outline the C++ code necessary to introduce a new element into the framework. In addition, we demonstrate what must be done in addition to use the element with the interpreter. Finally, we show the changes to the script that are needed to use this new element. Note, that all the code and example scripts mentioned in this document can be found in <code>OpenSees/EXAMPLES/NewElement</code>.</p>
<h2 id="a-simple-truss-example">A Simple Truss Example</h2>
<p>In this section the example script, example1.tcl, for the static analysis of the simple linear three bar truss example shown in figure <a href="#example1" data-reference-type="ref" data-reference="example1">[example1$$</a> is presented. For a more comprehensive set of examples showing the reader should is referred to the OpenSees examples manual, which can be found at http://opensees.berkeley.edu/OpenSees/OpenSeesExamples.pdf.</p>
<div class="center">
<p> </p>
</div>
<p>In the script, the analyst first creates a ModelBuilder object. In this example a BasicBuilder object is created. The construction of this object adds new commands to the interpreter, i.e. node, material, element, fix and load. It is these commands which can be used by the analyst to construct the model.</p>
<div class="highlight"><pre><span></span># create the ModelBuilder object
model BasicBuilder -ndm 2 -ndf 2
</pre></div>

<p>The analyst then constructs the model. This is done by creating the four Node objects, a Material object, three Element objects, some Constraint objects, and finally a Load object.</p>
<div class="highlight"><pre><span></span><span class="c1"># build the model </span><span class="w"></span>
<span class="c1"># node nodeId xLoc yLoc</span><span class="w"></span>
<span class="n">node</span><span class="w"> </span><span class="mi">1</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w"> </span>
<span class="n">node</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">144</span><span class="w">   </span><span class="mi">0</span><span class="w"> </span>
<span class="n">node</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">168</span><span class="w">   </span><span class="mi">0</span><span class="w"></span>
<span class="n">node</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">72</span><span class="w">  </span><span class="mi">96</span><span class="w"></span>

<span class="c1"># material matId type &lt;type args&gt;</span><span class="w"></span>
<span class="n">uniaxialMaterial</span><span class="w"> </span><span class="n">Elastic</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">3000</span><span class="w"></span>

<span class="c1"># element truss trussId iNodeId jNodeId Area matId</span><span class="w"></span>
<span class="n">element</span><span class="w"> </span><span class="n">truss</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">element</span><span class="w"> </span><span class="n">truss</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">element</span><span class="w"> </span><span class="n">truss</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="c1"># constraint nodeId xFix? yFix?</span><span class="w"></span>
<span class="n">fix</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">fix</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">fix</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="c1"># pattern type patternID TimeSeries</span><span class="w"></span>
<span class="n">pattern</span><span class="w"> </span><span class="n">Plain</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Linear</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1"># load nodeID xForce yForce</span><span class="w"></span>
<span class="w">  </span><span class="nb">load</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="mi">50</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>After the model has been defined, the analyst then constructs the Analysis. This is done by first constructing the components of the Analysis object. In this example a BandSPD linear system of equation and a lapack solver (default for BandSPD), a ConstraintHandler object which deals with homogeneous single point constraints, an Integrator object of type LoadControl with a load step increment of one, an Algorithm object of type Linear, and a DOF_Numberer object of type RCM (reverse Cuthill-Mckee). Once these objects have been created, the StaticAnalysis object is constructed.</p>
<div class="highlight"><pre><span></span><span class="c1"># build the components for the analysis object</span><span class="w"></span>
<span class="n">system</span><span class="w"> </span><span class="n">BandSPD</span><span class="w"></span>
<span class="n">constraints</span><span class="w"> </span><span class="n">Plain</span><span class="w"></span>
<span class="n">integrator</span><span class="w"> </span><span class="n">LoadControl</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">algorithm</span><span class="w"> </span><span class="n">Linear</span><span class="w"></span>
<span class="n">numberer</span><span class="w"> </span><span class="n">RCM</span><span class="w"></span>

<span class="c1"># create the analysis object </span><span class="w"></span>
<span class="n">analysis</span><span class="w"> </span><span class="n">Static</span><span class="w"> </span>
</pre></div>

<p>After the Analysis object is constructed a Recorder object is created. In this example we create a NodeRecorder to record the load factor and the two nodal displacements at Node 4, the results are stored in the file example.out.</p>
<div class="highlight"><pre><span></span><span class="c1"># create a Recorder object for the nodal displacements at node 4</span><span class="w"></span>
<span class="n">recorder</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="n">example</span><span class="o">.</span><span class="n">out</span><span class="w"> </span><span class="n">disp</span><span class="w"> </span><span class="o">-</span><span class="nb">load</span><span class="w"> </span><span class="o">-</span><span class="n">nodes</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">-</span><span class="n">dof</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
</pre></div>

<p>Finally the analysis is performed and the results are printed.</p>
<div class="highlight"><pre><span></span># perform the analysis
analyze 1

# print the results at node 4 and at all elements
print node 4
print ele
playback 1
</pre></div>

<p>When OpenSees is run and the commands outlined above are input by the analyst at the interpreter prompt, or are sourced from a file using the source filename command, the following is output by the program.</p>
<div class="highlight"><pre><span></span><span class="w"> </span><span class="n">Node</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">        </span><span class="n">Coordinates</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="mi">72</span><span class="w"> </span><span class="mi">96</span><span class="w"> </span>
<span class="w">        </span><span class="n">commitDisps</span><span class="p">:</span><span class="w"> </span><span class="mf">0.530093</span><span class="w"> </span><span class="o">-</span><span class="mf">0.177894</span><span class="w"> </span>
<span class="w">        </span><span class="n">unbalanced</span><span class="w"> </span><span class="n">Load</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="mi">50</span><span class="w"> </span>

<span class="n">Element</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="n">Truss</span><span class="w">  </span><span class="n">iNode</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">jNode</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">Area</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span>
<span class="w">         </span><span class="n">strain</span><span class="p">:</span><span class="w"> </span><span class="mf">0.00146451</span><span class="w"> </span><span class="n">axial</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="mf">43.9352</span><span class="w"> </span>
<span class="w">         </span><span class="n">unbalanced</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="mf">26.3611</span><span class="w"> </span><span class="mf">35.1482</span><span class="w"> </span><span class="o">-</span><span class="mf">26.3611</span><span class="w"> </span><span class="o">-</span><span class="mf">35.1482</span><span class="w"> </span>
<span class="w">         </span><span class="n">Material</span><span class="p">:</span><span class="w"> </span><span class="n">ElasticMaterialModel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="n">E</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w"></span>

<span class="n">Element</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="n">Truss</span><span class="w">  </span><span class="n">iNode</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">jNode</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">Area</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span>
<span class="w">         </span><span class="n">strain</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">0.00383642</span><span class="w"> </span><span class="n">axial</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">57.5463</span><span class="w"> </span>
<span class="w">         </span><span class="n">unbalanced</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="mf">34.5278</span><span class="w"> </span><span class="o">-</span><span class="mf">46.0371</span><span class="w"> </span><span class="o">-</span><span class="mf">34.5278</span><span class="w"> </span><span class="mf">46.0371</span><span class="w"> </span>
<span class="w">         </span><span class="n">Material</span><span class="p">:</span><span class="w"> </span><span class="n">ElasticMaterialModel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="n">E</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w"></span>

<span class="n">Element</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="n">Truss</span><span class="w">  </span><span class="n">iNode</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">jNode</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">Area</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span>
<span class="w">         </span><span class="n">strain</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">0.00368743</span><span class="w"> </span><span class="n">axial</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">55.3114</span><span class="w"> </span>
<span class="w">         </span><span class="n">unbalanced</span><span class="w"> </span><span class="nb">load</span><span class="p">:</span><span class="w"> </span><span class="mf">39.1111</span><span class="w"> </span><span class="o">-</span><span class="mf">39.1111</span><span class="w"> </span><span class="o">-</span><span class="mf">39.1111</span><span class="w"> </span><span class="mf">39.1111</span><span class="w"> </span>
<span class="w">         </span><span class="n">Material</span><span class="p">:</span><span class="w"> </span><span class="n">ElasticMaterialModel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="n">E</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w"></span>

<span class="mi">1</span><span class="w"> </span><span class="mf">0.530093</span><span class="w"> </span><span class="o">-</span><span class="mf">0.177894</span><span class="w"></span>
</pre></div>

<h2 id="introducing-a-new-element-into-opensees">Introducing a New Element into OpenSees</h2>
<p>We will look at the C++ code that is required to introduce a new Truss element, MyTruss, into the framework and a new command myTruss into the interpreter. The new class will work in planar problems where each node has two degrees-of-freedom. The new type will be complicated by the fact that each instance will be associated with a UniaxialMaterial object, this is done to show what this entails for parallel and database processing.</p>
<p>To introduce the new class into OpenSees three new files must be created, MyTruss.h and MyTruss.cpp, to define the class interface and implementation, and TclMyTrussCommand.cpp, to define the procedure to be invoked when the Tcl command myTruss is invoked. In addition two existing files must be modified, TclElementCommands.cpp, and FEM_ObjectBroker.C and FEM_ObjectBroker.C. The new files and modifications to existing files are outlined in the following subsections. All the files can be found in the OpenSees/EXAMPLES/ExampleNewElement directory.</p>
<h3 id="mytruss.h">MyTruss.h</h3>
<p>The file MyTruss.h defines the class interface and details information about the instance variables associated with the objects of type MyTruss. The interface first declares that the MyTruss class inherits from the Element class.</p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyTruss</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Element</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>

<p>The interface then defines two constructors and a destructor. The first constructor is used to construct each object by the analyst. The arguments passed include the elements id, the id’s of the two end nodes, a reference to a Material object (a copy of which is created by the MyTruss object), and the Area of the bar. In addition the analyst may specify a mass per unit volume, if none is specified <span class="math inline">\(0\)</span> is assumed. The second is used in parallel and database programming. The destructor is the method called when the object is being destroyed. It is called so that memory associated with the object is returned to the system.</p>
<div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="c1">// constructors   </span>
<span class="w">    </span><span class="n">MyTruss</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Nd1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Nd2</span><span class="p">,</span><span class="w"> </span><span class="n">UniaxialMaterial</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theMat</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="n">MyTruss</span><span class="p">();</span><span class="w">    </span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">MyTruss</span><span class="p">();</span><span class="w"></span>
</pre></div>

<p>After the destructor comes the public member functions, these define the methods that all other objects in the program will be able to invoke on objects of type MyTruss. These methods are all inherited from the Element class and each subclass of Element must declare them.</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="n">public</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">obtain</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">dof</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">connectivity</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getNumExternalNodes</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getExternalNodes</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getNumDOF</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">element</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setDomain</span><span class="p">(</span><span class="n">Domain</span><span class="w"> </span><span class="o">*</span><span class="n">theDomain</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">commitState</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">revertToLastCommit</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">        </span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">revertToStart</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">        </span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">obtain</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="n">mass</span><span class="p">,</span><span class="w"> </span><span class="n">damping</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">residual</span><span class="w"> </span><span class="n">information</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getTangentStiff</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getSecantStiff</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getDamp</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getMass</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">    </span>

<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">zeroLoad</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getResistingForce</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">getResistingForceIncInertia</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">);</span><span class="w">            </span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">output</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">sendSelf</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">commitTag</span><span class="p">,</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theChannel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">recvSelf</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">commitTag</span><span class="p">,</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theChannel</span><span class="p">,</span><span class="w"> </span><span class="n">FEM_ObjectBroker</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theBroker</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">displaySelf</span><span class="p">(</span><span class="n">Renderer</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theViewer</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">displayMode</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="n">fact</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Print</span><span class="p">(</span><span class="n">OPS_Stream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="mi">0</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="o">*</span><span class="n">setResponse</span><span class="p">(</span><span class="nb">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">Information</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eleInformation</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getResponse</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">responseID</span><span class="p">,</span><span class="w"> </span><span class="n">Information</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eleInformation</span><span class="p">);</span><span class="w"></span>
</pre></div>

<p>Following the declaration of the public member functions comes the declaration of a private member function, computeStrain(), which can only be called by objects of type MyTruss.</p>
<div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="c1">// private member function - only available to objects of the class</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">computeCurrentStrain</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
</pre></div>

<p>After the private member function is defined all the private variables, data which can only be accessed by objects of this type. First the instance variables associated with each object of this class are defined. Each object of this type will store its length, area, mass per unit volume, a pointer to a UniaxialMaterial object, a pointer to each of it’s end nodes, a pointer to a transformation matrix and an ID (integer array) object containing the node identifiers.</p>
<div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="c1">// private attributes - a copy for each object of the class</span>
<span class="w">  </span><span class="n">UniaxialMaterial</span><span class="w"> </span><span class="o">*</span><span class="n">theMaterial</span><span class="p">;</span><span class="w">  </span><span class="c1">// pointer to a material</span>
<span class="w">  </span><span class="n">ID</span><span class="w">  </span><span class="n">externalNodes</span><span class="p">;</span><span class="w">              </span><span class="c1">// contains the id&#39;s of end nodes</span>
<span class="w">  </span><span class="n">Matrix</span><span class="w"> </span><span class="n">trans</span><span class="p">;</span><span class="w"> </span><span class="c1">// hold the transformation matrix</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">L</span><span class="p">;</span><span class="w">     </span><span class="c1">// length of MyTruss based on undeformed configuration</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">A</span><span class="p">;</span><span class="w">     </span><span class="c1">// area of MyTruss</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w">     </span><span class="c1">// weight per unit volume</span>
<span class="w">  </span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">end1Ptr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">end2Ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// two pointers to the trusses nodes.</span>
</pre></div>

<p>After the instance variable is defined some class variables. There is one instance of each of these variables shared by all objects of this class. The class variables comprise of a 3 matrices to return the stiffness, mass and damping matrices from the member functions and a vector to return the residual force. While the class variables could also be declared as instance variables, declaring them as class variables reduces the amount of memory required by each object of type MyTruss.</p>
<div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="c1">// private class attributes - single copy for all objects of the class</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="n">trussK</span><span class="p">;</span><span class="w">   </span><span class="c1">// class wide matrix for returning stiffness</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="n">trussD</span><span class="p">;</span><span class="w">   </span><span class="c1">// class wide matrix for returning damping</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="n">trussM</span><span class="p">;</span><span class="w">   </span><span class="c1">// class wide matrix for returning mass </span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="n">trussR</span><span class="p">;</span><span class="w">   </span><span class="c1">// class wide vector for returning residual</span>
</pre></div>

<h3 id="mytruss.c">MyTruss.C</h3>
<p>The MyTruss.C file contains the implementation. The file first initializes the class variables defined in the MyTruss.h file. Here the three matrices are initialized to be of size 4*4 and the Vector of size 4. It should be noted that access to the data stored in these objects is done using the C indexing notation, which starts at 0.</p>
<div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">// initialize the class wide variables</span>
<span class="w">  </span><span class="n">Matrix</span><span class="w"> </span><span class="nf">MyTruss::trussK</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Matrix</span><span class="w"> </span><span class="nf">MyTruss::trussM</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Matrix</span><span class="w"> </span><span class="nf">MyTruss::trussD</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Vector</span><span class="w"> </span><span class="nf">MyTruss::trussR</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>

<p>After the initialization of the class variables, the constructors for the class are implemented. The first constructor takes as arguments the objects identifier, the identifiers of the two end nodes, a reference to the objects material and the objects area. The constructor initializes the instance variables with the appropriate values. In addition, the constructor makes a copy of the Material object; it is this copy that will be used by the MyTruss object. The second constructor, which takes no arguments, is used in parallel and database programming for constructing an empty object whose instance variables will be filled in by the object itself when recvSelf() is invoked on the object.</p>
<div class="highlight"><pre><span></span><span class="n">MyTruss</span><span class="p">::</span><span class="n">MyTruss</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">Nd1</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">Nd2</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">UniaxialMaterial</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theMat</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span><span class="w"></span>
<span class="p">:</span><span class="n">Element</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">ELE_TAG_MyTruss</span><span class="p">),</span><span class="w">     </span>
<span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="w"> </span><span class="n">trans</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">L</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span><span class="w"> </span><span class="n">end1Ptr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">end2Ptr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span><span class="n">object</span><span class="w"></span>
<span class="w">    </span><span class="n">theMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMat</span><span class="o">.</span><span class="n">getCopy</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">id</span><span class="s1">&#39;s</span>
<span class="w">    </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nd1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nd2</span><span class="p">;</span><span class="w">        </span>
<span class="p">}</span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">invoked</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">FE_ObjectBroker</span><span class="w"> </span><span class="n">only</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">MyTruss</span><span class="p">()</span><span class="w"></span>
<span class="p">:</span><span class="n">Element</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ELE_TAG_MyTruss</span><span class="p">),</span><span class="w">     </span>
<span class="w"> </span><span class="n">theMaterial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="w"> </span><span class="n">trans</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">L</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">end1Ptr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">end2Ptr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">nothing</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>After the two constructors comes the destructor for the class. This is the function that is invoked when the object is removed from the system. Each object is responsible for cleaning up after itself, anything the object created using the new operator. The destructor is also responsible for memory allocated by other objects, in this case the UniaxialMaterial object.</p>
<div class="highlight"><pre><span></span><span class="nt">MyTruss</span><span class="o">::~</span><span class="nt">MyTruss</span><span class="o">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(theMaterial</span><span class="w"> </span><span class="err">!=</span><span class="w"> </span><span class="err">0)</span><span class="w"></span>
<span class="w">        </span><span class="err">delete</span><span class="w"> </span><span class="err">theMaterial</span><span class="p">;</span><span class="w">    </span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>After the destructor comes a number of utility methods that each Element type must provide. These include the methods getNumberExternalNodes() to return the number of end nodes, getExternalNodes() an ID object containing the identifiers of these nodes, and getNumDOF() to return the number of degrees of freedom associated with the Element. In addition, there is the method setDomain() that is called when the object is added to a Domain object. When this method is invoked each MyTruss object completes the initialization of it’s instance variables. For example, if the two end nodes exist in the Domain the pointers to these end nodes are now set.</p>
<div class="highlight"><pre><span></span><span class="nb nb-Type">int</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getNumExternalNodes</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getExternalNodes</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">externalNodes</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nb nb-Type">int</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getNumDOF</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nb nb-Type">void</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">setDomain</span><span class="p">(</span><span class="n">Domain</span><span class="w"> </span><span class="o">*</span><span class="n">theDomain</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Domain</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">pointers</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">Nd1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">Nd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">end1Ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theDomain</span><span class="o">-&gt;</span><span class="n">getNode</span><span class="p">(</span><span class="n">Nd1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">end2Ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theDomain</span><span class="o">-&gt;</span><span class="n">getNode</span><span class="p">(</span><span class="n">Nd2</span><span class="p">);</span><span class="w">  </span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">end1Ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t go any further - otherwise segmentation fault</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">end2Ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t go any further - otherwise segmentation fault</span>
<span class="w">    </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DomainComponent</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">method</span><span class="o">.</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="n">THIS</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="n">VERY</span><span class="w"> </span><span class="n">VERY</span><span class="w"> </span><span class="n">IMPORTANT</span><span class="w"></span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">DomainComponent</span><span class="p">::</span><span class="n">setDomain</span><span class="p">(</span><span class="n">theDomain</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dof</span><span class="s1">&#39;s</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">dofNd1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getNumberDOF</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">dofNd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getNumberDOF</span><span class="p">();</span><span class="w">   </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dofNd1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">dofNd2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t go any further - otherwise segmentation fault</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">transformation</span><span class="w"> </span><span class="n">matrix</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end1Crd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getCrds</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end2Crd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getCrds</span><span class="p">();</span><span class="w"> </span>

<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Crd</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">end1Crd</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Crd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">end1Crd</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span>
<span class="w">    </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t go any further - otherwise divide by 0 error</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dx</span><span class="o">/</span><span class="n">L</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dy</span><span class="o">/</span><span class="n">L</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">cs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sn</span><span class="p">;</span><span class="w">    </span>
<span class="w">    </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">cs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">sn</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">nodal</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">lumped</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="n">approach</span><span class="w"></span>
<span class="w">    </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">rho</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">constructor</span><span class="w"></span>
<span class="p">}</span><span class="w">        </span>
</pre></div>

<p>Following the methods comes a number of methods related to the solution algorithm. These methods include commitState(), which is invoked when a point on the solution path has been achieved for a step in the analysis, revertToLastCommit() which is a method invoked to inform the Element that convergence to an acceptable solution was not achieved and that the Element is to return to the state it was at when the last commit() method was invoked on it. The method revertToStart() is invoked to tell the Element that it is to return to the state it was at the beginning of the analysis. For a MyTruss element type, which has no state information, the object itself will simply invoke the corresponding method on it’s associated material object.</p>
<div class="highlight"><pre><span></span><span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">commitState</span><span class="o">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">theMaterial-&gt;commitState()</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">revertToLastCommit</span><span class="o">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">theMaterial-&gt;revertToLastCommit()</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">revertToStart</span><span class="o">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">theMaterial-&gt;revertToStart()</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">update</span><span class="o">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">determine</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">current</span><span class="w"> </span><span class="err">strain</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">trial</span><span class="w"> </span><span class="err">displacements</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">nodes</span><span class="w"></span>
<span class="w">  </span><span class="err">double</span><span class="w"> </span><span class="err">strain</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">this-&gt;computeCurrentStrain()</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">strain</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">materials</span><span class="w"></span>
<span class="w">  </span><span class="err">theMaterial-&gt;setTrialStrain(strain)</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="err">return</span><span class="w"> </span><span class="err">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>After these come the implementation of the typical Element methods to obtain the current linearized stiffness, mass and damping matrices, and the residual vector. In each of these methods, a call is made to the objects computeCurrentStrain() method. Once the strain has been computed the tangent matrices and residual vector are computed using standard matlab like operations. It should be noted that the results are placed into the class matrices and vectors.</p>
<div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getTangentStiff</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="n">trussK</span><span class="o">.</span><span class="n">Zero</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trussK</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">set</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">update</span><span class="p">()</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">invoked</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getTangent</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tangent</span><span class="w"> </span><span class="n">stiffness</span><span class="w"> </span><span class="n">matrix</span><span class="w"></span>
<span class="w">    </span><span class="n">trussK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans</span><span class="o">^</span><span class="n">trans</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">trussK</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">E</span><span class="o">/</span><span class="n">L</span><span class="p">;</span><span class="w">  </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">trussK</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getSecantStiff</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="n">trussK</span><span class="o">.</span><span class="n">Zero</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trussK</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStrain</span><span class="p">();</span><span class="w"></span>


<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">stress</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">stress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStress</span><span class="p">();</span><span class="w">   </span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">compute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tangent</span><span class="w">  </span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stress</span><span class="o">/</span><span class="n">strain</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tangent</span><span class="w"> </span><span class="n">stiffness</span><span class="w"> </span><span class="n">matrix</span><span class="w"></span>
<span class="w">    </span><span class="n">trussK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans</span><span class="o">^</span><span class="n">trans</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">trussK</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">E</span><span class="o">/</span><span class="n">L</span><span class="p">;</span><span class="w">  </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">trussK</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="w">    </span>
<span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getDamp</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">damping</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">element</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">trussD</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getMass</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="n">trussM</span><span class="o">.</span><span class="n">Zero</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trussM</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">assuming</span><span class="w"> </span><span class="n">lumped</span><span class="w"> </span><span class="n">mass</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">nodeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="n">trussM</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeMass</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">trussM</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nb nb-Type">void</span><span class="w"> </span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">zeroLoad</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">loads</span><span class="w"> </span><span class="n">associated</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">object</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getResistingForce</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="n">trussR</span><span class="o">.</span><span class="n">Zero</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trussR</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ku</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pext</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">transformation</span><span class="w"> </span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStress</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">force</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">trussR</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">getResistingForceIncInertia</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ku</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Pext</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Ma</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">resisting</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">sans</span><span class="w"> </span><span class="n">mass</span><span class="w"></span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getResistingForce</span><span class="p">();</span><span class="w">  </span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="n">portion</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">nodeMass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">accel1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getTrialAccel</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">accel2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getTrialAccel</span><span class="p">();</span><span class="w">    </span>
<span class="w">    </span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nodeMass</span><span class="o">*</span><span class="n">accel1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">           </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nodeMass</span><span class="o">*</span><span class="n">accel2</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">trussR</span><span class="p">;</span><span class="w">    </span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>After the more standard Element methods come two pairwise methods that are required for parallel and database processing, sendSelf() and recvSelf(). Each Element object is responsible for sending enough information to a Channel object such that an Element of similar type, on the other end of the Channel, will be able to initialize itself so that the geometry and state information in the two objects are the same. When sending this data to a Channel a MyTruss object initially sends its tag, it’s unique database tag, it’s area, the Material objects tag in a vector object to the Channel. The MyClass object then sends it’s ID to the Channel and finally the MaterialObject is told to send itself. When receiving itself from a Channel a MyTruss object will receive this information. It should be noticed that before the object can invoke recvSelf() on its Material object it must create the appropriate type of Material object, this it does using the FEM_ObjectBroker object and the Material objects class tag.</p>
<div class="highlight"><pre><span></span><span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">sendSelf</span><span class="o">(</span><span class="nt">int</span><span class="w"> </span><span class="nt">commitTag</span><span class="o">,</span><span class="w"> </span><span class="nt">Channel</span><span class="w"> </span><span class="o">&amp;</span><span class="nt">theChannel</span><span class="o">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t check for dataTag == 0 for Element</span>
<span class="s1">    // objects as that is taken care of in a commit by the Domain</span>
<span class="s1">    // object - don&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="kc">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="kc">to</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="n">data</span><span class="w"></span>
<span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">dataTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this-</span><span class="o">&gt;</span><span class="nf">getDbTag</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">MyTruss</span><span class="w"> </span><span class="err">packs</span><span class="w"> </span><span class="err">it&#39;s</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">into</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">Vector</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">sends</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">theChannel</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">along</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">it&#39;s</span><span class="w"> </span><span class="err">dbTag</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">commitTag</span><span class="w"> </span><span class="err">passed</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">arguments</span><span class="w"></span>

<span class="w">    </span><span class="err">Vector</span><span class="w"> </span><span class="err">data(5)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">data(0)</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">this-&gt;getTag()</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">data(1)</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">A</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">data(4)</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">M</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">data(2)</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">theMaterial-&gt;getClassTag()</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">int</span><span class="w"> </span><span class="err">matDbTag</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">theMaterial-&gt;getDbTag()</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="kc">to</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">database</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="kc">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="n">if</span><span class="w"> </span><span class="p">(</span><span class="n">matDbTag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">matDbTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theChannel</span><span class="o">.</span><span class="nf">getDbTag</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="err">if</span><span class="w"> </span><span class="err">(matDbTag</span><span class="w"> </span><span class="err">!=</span><span class="w"> </span><span class="err">0)</span><span class="w"></span>
<span class="w">           </span><span class="err">theMaterial-&gt;setDbTag(matDbTag)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nt">data</span><span class="o">(</span><span class="nt">3</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">matDbTag</span><span class="o">;</span><span class="w"></span>

<span class="w">    </span><span class="nt">theChannel</span><span class="p">.</span><span class="nc">sendVector</span><span class="o">(</span><span class="nt">dataTag</span><span class="o">,</span><span class="w"> </span><span class="nt">commitTag</span><span class="o">,</span><span class="w"> </span><span class="nt">data</span><span class="o">);</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nt">MyTruss</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">sends</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">tags</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">it</span><span class="s1">&#39;s two end nodes</span>
<span class="s1">    theChannel.sendID(dataTag, commitTag, externalNodes);</span>

<span class="s1">    // finally MyTruss asks it&#39;</span><span class="nt">s</span><span class="w"> </span><span class="nt">material</span><span class="w"> </span><span class="nt">object</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">send</span><span class="w"> </span><span class="nt">itself</span><span class="w"></span>
<span class="w">    </span><span class="nt">theMaterial-</span><span class="o">&gt;</span><span class="nt">sendSelf</span><span class="o">(</span><span class="nt">commitTag</span><span class="o">,</span><span class="w"> </span><span class="nt">theChannel</span><span class="o">);</span><span class="w"></span>

<span class="w">    </span><span class="nt">return</span><span class="w"> </span><span class="nt">0</span><span class="o">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="nt">int</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">recvSelf</span><span class="o">(</span><span class="nt">int</span><span class="w"> </span><span class="nt">commitTag</span><span class="o">,</span><span class="w"> </span><span class="nt">Channel</span><span class="w"> </span><span class="o">&amp;</span><span class="nt">theChannel</span><span class="o">,</span><span class="w"> </span><span class="nt">FEM_ObjectBroker</span><span class="w"> </span><span class="o">&amp;</span><span class="nt">theBroker</span><span class="o">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">int</span><span class="w"> </span><span class="err">dataTag</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">this-&gt;getDbTag()</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">MyTruss</span><span class="w"> </span><span class="err">creates</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">Vector,</span><span class="w"> </span><span class="err">receives</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Vector</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">then</span><span class="w"> </span><span class="err">sets</span><span class="w"> </span><span class="err">the</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">internal</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Vector</span><span class="w"></span>

<span class="w">    </span><span class="err">Vector</span><span class="w"> </span><span class="err">data(5)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">theChannel.recvVector(dataTag,</span><span class="w"> </span><span class="err">commitTag,</span><span class="w"> </span><span class="err">data)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">this-&gt;setTag((int)data(0))</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">A</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">data(1)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">M</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">data(4)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">MyTruss</span><span class="w"> </span><span class="err">now</span><span class="w"> </span><span class="err">receives</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">tags</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">it&#39;s</span><span class="w"> </span><span class="err">two</span><span class="w"> </span><span class="err">external</span><span class="w"> </span><span class="err">nodes</span><span class="w"></span>
<span class="w">    </span><span class="err">theChannel.recvID(dataTag,</span><span class="w"> </span><span class="err">commitTag,</span><span class="w"> </span><span class="err">externalNodes)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">material</span><span class="w"> </span><span class="err">object</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">correct</span><span class="w"> </span><span class="err">type,</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">sets</span><span class="w"> </span><span class="err">its</span><span class="w"> </span><span class="err">database</span><span class="w"> </span><span class="err">tag</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">asks</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">object</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">receive</span><span class="w"> </span><span class="err">itself.</span><span class="w"></span>
<span class="w">    </span><span class="err">int</span><span class="w"> </span><span class="err">matClass</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">data(2)</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="err">int</span><span class="w"> </span><span class="err">matDb</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">data(3)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">theMaterial</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">theBroker.getNewUniaxialMaterial(matClass)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">dbTag</span><span class="w"> </span><span class="err">before</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">receive</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">material</span><span class="w">  </span><span class="err">-</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">important</span><span class="w"></span>
<span class="w">    </span><span class="err">theMaterial-&gt;setDbTag(matDb)</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="err">theMaterial-&gt;recvSelf(commitTag,</span><span class="w"> </span><span class="err">theChannel,</span><span class="w"> </span><span class="err">theBroker)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>To display graphically an Element in an image the displaySelf() method is invoked on an Element object. What is displayed depends on the flag and display factor values provided as arguments. The display factor is used to magnify the nodal displacements at the member ends so that distortion of the structure is visible. The flag is used to indicate what measure is to be displayed. A MyTruss object will display the strain in the object if a <span class="math inline">\(1\)</span> is passed, otherwise the force in the object is displayed.</p>
<div class="highlight"><pre><span></span><span class="nb nb-Type">int</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">displaySelf</span><span class="p">(</span><span class="n">Renderer</span><span class="w"> </span><span class="o">&amp;</span><span class="n">theViewer</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">displayMode</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="n">fact</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">truss</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">measure</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">distorted</span><span class="w"> </span><span class="n">image</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="n">d</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end1Crd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getCrds</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end2Crd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getCrds</span><span class="p">();</span><span class="w"> </span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end1Disp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getDisp</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">end2Disp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getDisp</span><span class="p">();</span><span class="w">    </span>

<span class="w">    </span><span class="n">Vector</span><span class="w"> </span><span class="n">v1</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Vector</span><span class="w"> </span><span class="n">v2</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Crd</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">end1Disp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">fact</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Crd</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">end2Disp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">fact</span><span class="p">;</span><span class="w">    </span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">displayMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">drawing</span><span class="w"> </span><span class="n">measure</span><span class="w"></span>
<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStrain</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">theViewer</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">strain</span><span class="p">,</span><span class="w"> </span><span class="n">strain</span><span class="p">);</span><span class="w">  </span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">displayMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">material</span><span class="w"> </span><span class="n">stress</span><span class="w"></span>
<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">stress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStress</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">theViewer</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">stress</span><span class="p">,</span><span class="w"> </span><span class="n">stress</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">axial</span><span class="w"> </span><span class="n">force</span><span class="w"></span>
<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStress</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">theViewer</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>To print the state of the Element, to a file or to the screen, the Print() method is invoked on the Element object. What is printed by the object, depends on the flag passed as an argument. A MyTruss object prints a detailed description of its state if <span class="math inline">\(0\)</span> is passed, a shortened version if <span class="math inline">\(1\)</span> is passed, and nothing at all if anything else is passed.</p>
<div class="highlight"><pre><span></span><span class="nb nb-Type">void</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">Print</span><span class="p">(</span><span class="n">OPS_Stream</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">compute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">axial</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">member</span><span class="w"></span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">strain</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">strain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">strain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStrain</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">theMaterial</span><span class="o">-&gt;</span><span class="n">getStress</span><span class="p">();</span><span class="w">    </span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">trussR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">force</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">everything</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;Element: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getTag</span><span class="p">();</span><span class="w"> </span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; type: MyTruss  iNode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; jNode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">externalNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; Area: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; Mass (PerUnitVolume): &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; </span><span class="se">\n\t</span><span class="s2"> strain: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">strain</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; axial load: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="n">force</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; </span><span class="se">\n\t</span><span class="s2"> unbalanced load: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trussR</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot; </span><span class="se">\t</span><span class="s2"> Material: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">theMaterial</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endln</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">ele</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">force</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getTag</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endln</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>To allow the analyst to obtain information specific to the Truss element the methods setResponse() and getResponse() are provided. The setResponse() method is used to obtain an integer code that is used in subsequent requests to the MyTruss object for information. The integer returned depends on the array of strings passed to the element. A MyTruss object responds to requests for the axial force, ‘axialForce’, and the tangent stiffness matrix, ‘stiffness’. Requests for material information are passed to the material object. A <span class="math inline">\(-1\)</span> is returned if the MyTruss does not supply this information. it should be noted that for information returned in ID, vector and Matrix objects the MyTruss elements allocate these objects from the heap, this is done to reduce memory overhead in the elements. The getResponse() method is used to obtain the information.</p>
<div class="highlight"><pre><span></span><span class="nt">Response</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">setResponse</span><span class="o">(</span><span class="nt">char</span><span class="w"> </span><span class="o">**</span><span class="nt">argv</span><span class="o">,</span><span class="w"> </span><span class="nt">int</span><span class="w"> </span><span class="nt">argc</span><span class="o">,</span><span class="w"> </span><span class="nt">Information</span><span class="w"> </span><span class="o">&amp;</span><span class="nt">eleInformation</span><span class="o">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">compare</span><span class="w"> </span><span class="err">argv</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">known</span><span class="w"> </span><span class="err">response</span><span class="w"> </span><span class="err">types</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Truss</span><span class="w"></span>
<span class="w">    </span><span class="err">//</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">axial</span><span class="w"> </span><span class="err">force</span><span class="w"></span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(strcmp(argv</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="err">,&quot;axialForce&quot;)</span><span class="w"> </span><span class="err">==0)</span><span class="w"> </span>
<span class="w">      </span><span class="err">return</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">ElementResponse(this,</span><span class="w"> </span><span class="err">1,</span><span class="w"> </span><span class="err">0.0)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">material</span><span class="w"> </span><span class="err">quantity</span><span class="w">    </span>
<span class="w">    </span><span class="err">else</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">(strcmp(argv</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="err">,&quot;material&quot;)</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">0)</span><span class="w"></span>
<span class="w">      </span><span class="err">return</span><span class="w"> </span><span class="err">theMaterial-&gt;setResponse(&amp;argv</span><span class="cp">[</span><span class="mi">1</span><span class="cp">]</span><span class="err">,</span><span class="w"> </span><span class="err">argc-1,</span><span class="w"> </span><span class="err">eleInformation)</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="err">else</span><span class="w"></span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nt">int</span><span class="w"> </span>
<span class="nt">MyTruss</span><span class="p">::</span><span class="nd">getResponse</span><span class="o">(</span><span class="nt">int</span><span class="w"> </span><span class="nt">responseID</span><span class="o">,</span><span class="w"> </span><span class="nt">Information</span><span class="w"> </span><span class="o">&amp;</span><span class="nt">eleInformation</span><span class="o">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="err">switch</span><span class="w"> </span><span class="err">(responseID)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="err">case</span><span class="w"> </span><span class="err">-1:</span><span class="w"></span>
<span class="w">      </span><span class="err">return</span><span class="w"> </span><span class="err">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span>
<span class="w">    </span><span class="err">case</span><span class="w"> </span><span class="err">1:</span><span class="w"></span>
<span class="w">      </span><span class="err">return</span><span class="w"> </span><span class="err">eleInfo.setDouble(A</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">theMaterial-&gt;getStress())</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">default</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="n">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</pre></div>

<p>Finally the private member function for determining the current strain in the element if defined. This method uses the nodal pointers to look at the current trial displacements at the nodes from which the strain can be determined.</p>
<div class="highlight"><pre><span></span><span class="n">double</span><span class="w"></span>
<span class="n">MyTruss</span><span class="p">::</span><span class="n">computeCurrentStrain</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">strain</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">disp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end1Ptr</span><span class="o">-&gt;</span><span class="n">getTrialDisp</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="o">&amp;</span><span class="n">disp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end2Ptr</span><span class="o">-&gt;</span><span class="n">getTrialDisp</span><span class="p">();</span><span class="w">  </span>

<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">dLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">dLength</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="p">(</span><span class="n">disp2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">disp1</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">trans</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">double</span><span class="w"> </span><span class="n">strain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dLength</span><span class="o">/</span><span class="n">L</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">strain</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<h3 id="tclelementcommands.cpp">TclElementCommands.cpp</h3>
<p>The TclElementCommands.cpp file contains the C++ procedure TclModelBuilderElementCommand(). It is this procedure that is invoked every time the <strong>element</strong> command is invoked. This file is modified to allow the analyst to construct a new element of type MyTruss with the command:</p>
<div class="highlight"><pre><span></span>  element myTruss eleId iNodeID jNodeId area materialID massPerUnitVolume
</pre></div>

<p>To do this in the prototypes section of the file the the procedure TclModelBuilder_addMyTruss() is declared to be an externally defined procedure. (NOTE that the whole element myTruss command could be parsed in this file. However, to keep things modular and allow the command to work with other interpreters that may be developed it has been the convention to place the procedure in a seperate file).</p>
<div class="highlight"><pre><span></span>extern int
TclModelBuilder_MyTruss(ClientData , Tcl_Interp *,  int, char **,
                    Domain*, TclModelBuilder *, int);
</pre></div>

<p>Then in the body of the procedure we inform the interpreter that, if the second argument of the <strong>element</strong> command is the string <strong>myTruss</strong>, that the external procedure is to be invoked. This is done by adding the following 4 lines of code:</p>
<div class="highlight"><pre><span></span>  } <span class="k">else</span> <span class="k">if</span> <span class="ss">(</span><span class="nv">strcmp</span><span class="ss">(</span><span class="nv">argv</span>[<span class="mi">1</span>],<span class="s2">&quot;</span><span class="s">myTruss</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="o">==</span> <span class="mi">0</span><span class="ss">)</span> {
    <span class="nv">int</span> <span class="nb">result</span> <span class="o">=</span> <span class="nv">TclModelBuilder_MyTruss</span><span class="ss">(</span><span class="nv">clientData</span>, <span class="nv">interp</span>, <span class="nv">argc</span>, <span class="nv">argv</span>,
                             <span class="nv">theTclDomain</span>, <span class="nv">theTclBuilder</span><span class="ss">)</span><span class="c1">;</span>
    <span class="k">return</span> <span class="nb">result</span><span class="c1">;</span>
</pre></div>

<h3 id="tclmytrusscommand.cpp">TclMyTrussCommand.cpp</h3>
<p>In this file we place the procedure, TclModelBuilder_MyTruss(), that was defined to be external in TclElementCommands.cpp. In this procedure a check is first made to insure that the correct number of arguments have been provided. The arguments are then parsed. A MyTruss element object is finally constructed with the parsed arguments and added to the domain.</p>
<div class="highlight"><pre><span></span><span class="n">int</span><span class="w"></span>
<span class="n">TclModelBuilder_MyTruss</span><span class="p">(</span><span class="n">ClientData</span><span class="w"> </span><span class="n">clientData</span><span class="p">,</span><span class="w"> </span><span class="n">Tcl_Interp</span><span class="w"> </span><span class="o">*</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// make sure at least one other argument to contain type of system</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING bad command - myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w">    </span>

<span class="w">  </span><span class="c1">// get the id, x_loc and y_loc</span><span class="w"></span>
<span class="w">  </span><span class="n">int</span><span class="w"> </span><span class="n">trussId</span><span class="p">,</span><span class="w"> </span><span class="n">iNode</span><span class="p">,</span><span class="w"> </span><span class="n">jNode</span><span class="p">,</span><span class="w"> </span><span class="n">matID</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">double</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">Tcl_GetInt</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trussId</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid eleId- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">Tcl_GetInt</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iNode</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid iNode- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">Tcl_GetInt</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jNode</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid jNode- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">Tcl_GetDouble</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid A- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">Tcl_GetInt</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">matID</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid matId- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Tcl_GetDouble</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">blah</span><span class="o">-&gt;</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WARNING invalid matId- myTruss eleId iNode jNode Area matID&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w">  </span>
<span class="w">  </span>
<span class="w">  </span><span class="n">UniaxialMaterial</span><span class="w"> </span><span class="o">*</span><span class="n">theMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theModelBuilder</span><span class="o">-&gt;</span><span class="n">getUniaxialMaterial</span><span class="p">(</span><span class="n">matID</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">theMaterial</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARNING TclPlaneTruss - truss - no Material found with tag &quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">matID</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kd">endl</span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// now create the truss and add it to the Domain</span><span class="w"></span>
<span class="w">  </span><span class="n">MyTruss</span><span class="w"> </span><span class="o">*</span><span class="n">theTruss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyTruss</span><span class="p">(</span><span class="n">trussId</span><span class="p">,</span><span class="n">iNode</span><span class="p">,</span><span class="n">jNode</span><span class="p">,</span><span class="o">*</span><span class="n">theMaterial</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">M</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">theTruss</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARNING TclPlaneTruss - addMyTruss - ran out of memory for node &quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trussId</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kd">endl</span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">theDomain</span><span class="o">-&gt;</span><span class="n">addElement</span><span class="p">(</span><span class="n">theTruss</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kr">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">delete</span><span class="w"> </span><span class="n">theTruss</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;WARNING TclPlaneTruss - addTruss - could not add Truss to domain &quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">opserr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trussId</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kd">endl</span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// if get here we have successfully created the node and added it to the domain</span><span class="w"></span>
<span class="w">  </span><span class="kr">return</span><span class="w"> </span><span class="n">TCL_OK</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<h3 id="fem_objectbroker.cpp">FEM_ObjectBroker.cpp</h3>
<p>An <code>FEM_ObjectBroker</code> is the object responsible for creating blank objects of a specific type. This object is required for parallel and database programming. The <code>MyTruss.h</code> file is first included in the list of element header files. Then code in the getNewElement() method is revised to return a new <code>MyTruss</code> element if requested.</p>
<div class="highlight"><pre><span></span><span class="w">    </span><span class="n">Element</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">    </span><span class="nf">FEM_ObjectBroker::getNewElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">classTag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">switch</span><span class="p">(</span><span class="n">classTag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// existing code</span>
<span class="w">            </span><span class="p">...</span><span class="w"></span>
<span class="w">            </span><span class="c1">// new two lines of code added for MyTruss element</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">ELE_TAG_MyTruss</span><span class="p">:</span><span class="w">  </span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyTruss</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="p">...</span><span class="w"></span>
</pre></div>

<h2 id="modification-to-example-script">Modification to Example Script</h2>
<p>To use the new element in the new OpenSees interpreter, the code in example1.tcl is modified. The modified code can be found in example2.tcl. The lines with the element command in <code>example1.tcl</code>:</p>
<div class="highlight"><pre><span></span><span class="c"># element truss trussId iNodeId jNodeId Area matId</span>
<span class="nv">element</span><span class="w"> </span>truss<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">element</span><span class="w"> </span>truss<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">element</span><span class="w"> </span>truss<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<p>are replaced with the following lines in <code>example2.tcl</code>:</p>
<div class="highlight"><pre><span></span><span class="c"># element truss trussId iNodeId jNodeId Area matId</span>
<span class="nv">element</span><span class="w"> </span>myTruss<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">element</span><span class="w"> </span>myTruss<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">element</span><span class="w"> </span>myTruss<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<b>
<center>
<p>Frank McKenna and Gregory L. Fenves</p>
<p>Pacific Earthquake Engineering Research Center</p>
<p>University of California, Berkeley</p>
<p>August 21, 2000</p>
Version 1.0 </b>
</center>


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Berkeley, CA
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>